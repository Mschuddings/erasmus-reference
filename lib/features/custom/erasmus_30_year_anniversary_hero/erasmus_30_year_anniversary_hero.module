<?php
/**
 * @file
 * Code for the Erasmus+ 30 year anniversary: Hero feature.
 */

include_once 'erasmus_30_year_anniversary_hero.features.inc';

/**
 * Implements hook_preprocess_node().
 */
function erasmus_30_year_anniversary_hero_preprocess_node(&$node) {
  global $theme;
  if ($node['type'] == 'erasmus_30_year_anniversary_hero'
     && $theme == 'erasmus_30year_anniversary'
     && $node['elements']['#view_mode'] == 'teaser') {

    $srt_uri = $node['field_30ya_hero_video_srt'][$node['language']][0]['uri'];
    $srt_url = file_create_url($srt_uri);
    $vid_url = $node['field_30ya_hero_video'][0]['file']->uri;
    unset($node['content']['field_30ya_hero_video']);
    $node['content']['srt'] = $srt_url;
    $node['content']['srt_lang'] = $node['language'];
    $node['content']['vid'] = file_create_url($vid_url);
    $banner_uri = $node['field_30ya_hero_banner'][0]['uri'];
    $node['content']['banner_url'] = file_create_url($banner_uri);
    $suggestions = $node['theme_hook_suggestions'];
    array_unshift($suggestions, 'node__erasmus_30_year_anniversary_hero__teaser');
    $node['theme_hook_suggestions'] = $suggestions;
  }
}
